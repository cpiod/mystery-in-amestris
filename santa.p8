pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- noname secret santa
-- cpiod

function _init()
-- o:
-- 0=up, 1=down, 2=left, 3=right
 p={x=9*8;y=4*8;o=1}
 p.ox=p.x
 p.oy=p.y
 
-- mode:
-- 1: move
-- 2: dialog
 mode=1
 
 -- npc number:
 -- 1=mustang
 -- 2=postman
 -- 3=apprentice
 npc={{id=1,x=10,y=3},{id=2,x=8,y=6}}
end

function _draw()
 camx=p.x-60
 camy=p.y-60
 camera(camx,camy)
 cls(5)
	palt(0,false)
	palt(14,true)
	--sspr(32,96,32,32,64,20,64,64,true)
	
	map()
	for n in all(npc) do
	 spr(n.id,n.x*8,n.y*8-3)
	end
	spr(16,p.x,p.y-3)
	
	if(mode==2)	prt_dial(d,a)
end

function _update60()
 if(mode==1) update_move()
 if(mode==2) update_diag()
end

function update_diag()
 if(btnp(‚¨ÜÔ∏è) and slct>1) slct-=1
 if(btnp(‚¨áÔ∏è) and slct<#a) slct+=1
 if btnp(üÖæÔ∏è) then
  nb=path[slct]
  if(nb==0 or nb==nil) mode=1 else change_dial()
 end
end

function change_dial()
 slct=1
 if dall[chat]==nil then
  -- nothing to say
  mode=1
 else
  d,a,path=dall[chat][nb],aall[chat][nb],pall[chat][nb]
  if(a==nil) a={"bye"}
 end
end

function start_dial(id)
 mode=2
 chat=id
 nb=1
 change_dial()
end

function update_move()
 if p.x==p.ox and p.y==p.oy then
  -- moving
	 local x,y=p.x,p.y
	 if(btn(‚¨ÜÔ∏è)) p.o=0 y-=8
	 if(btn(‚¨áÔ∏è)) p.o=1 y+=8
	 if(btn(‚û°Ô∏è)) p.o=3 x+=8
	 if(btn(‚¨ÖÔ∏è)) p.o=2 x-=8
	 if(x!=p.x)y=p.y
	 -- check collision
	 if(fget(mget(x/8,y/8),0)) x,y=p.x,p.y
	 for n in all(npc) do
	 -- npc in path: stop moving, start chatting
	  if(n.x==x/8 and n.y==y/8) x,y=p.x,p.y start_dial(n.id)
	 end
	 p.ox,p.oy=x,y
 else
  if(p.x<p.ox) p.x+=1
  if(p.x>p.ox) p.x-=1
  if(p.y<p.oy) p.y+=1
  if(p.y>p.oy) p.y-=1
 end
end
-->8
--dialog
dmust={"first !\nblabla","you said yes","you said no"}
dall={dmust}
amust={{"yes","no","bye"},{"again","bye"}}
aall={amust}
pmust={{2,3},{1},{}}
pall={pmust}
slct=1

faces={208,212,216,220}
-- nb: text id
-- d=text, list of lines
-- a=answers, list of lines
-- s=current selected answers
function prt_dial()
 spr(faces[chat],camx+5,camy,4,3)
 local i=0
 for n=1,#d do
  if(sub(d,n,n)=="\n") i+=1
 end
 for t in all(a) do
  for n=1,#t do
   if(sub(t,n,n)=="\n") i+=1
  end
 end
 local maxy=8+6*(i+#a)
 rectfill(3+camx,24+camy,125+camx,maxy+camy+24,6)
 rect(3+camx,24+camy,125+camx,maxy+camy+24,7)
 cursor(5+camx,26+camy,0)
 print(d)
 for i=1,#a do
  if i==slct then
   color(12)
   print(">"..a[i])
  else
    color(3)
    print(" "..a[i])
  end
 end

end
__gfx__
00000000ee000eeeee1111eeee000eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee0f0eeeeeafaeeeee0f0eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eefffeeeeefffeeeeefffeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eea61eeeee1ddeeeee4949ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e71617eeefd1dfeeef222fee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee666eeeeedd1eeeee222eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee1e1eeeeededeeeee2e2eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee0e0eeeee0e0eeeee0e0eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee999eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee9f9eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee9f9eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee111eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ef111fee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee111eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee1e1eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee0e0eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555666666664444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15551555666776664422224400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
15551555667777664242242400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111666776664224422400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555677666664224422400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55515551777767764242242400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55515551677677774422224400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11111111666667764444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeeeeeeeeeeeeeeeeeeeeee8eeeeeeeeeeee1111111eeeeeeeeeeeeeeeeeeeeeeeeeee00000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee99eeeeeeeeeeeeee
eeeee00000eeeeeeeeeeeeeeee89e8eeeeeeeeee1111111eeeeeeeeeeeeeeeeeeeeeeeeee000ff00eeeeeeeeeeeeeeeeeeeeeeeee9999999ee9eeeeeeeeeeeee
eeee0000000eeeeeeeeeeeeee88998eeeeeeeee111111111eeeeeeeeeeeeeeeeeeeeeeeee00fffff0eeeeeeeeeeeeeeeeeeeeeee9999fff99eeeeeeeeeeeeeee
eee000000000eeeeeeeeeeee89998eeeeeeeeee1111111111111eeeeeeeeeeeeeeeeeeee00ff5ff5feeeeeeeeeeeeeeeeeeeeee9999ffff99eeeeeeeeeeeeeee
ee0000000f000eeeeeeeeeee89998eeeeeeeeeeaaaaaaaaaeeeeeeeeeeeeeeeeeeeeeeee00fffffffeeeeeeeeeeeeeeeeeeeee99999fffff99eeeeeeeeeeeeee
ee00000ffff000eeeeeeeeeee998eeeeeeeeeeeaaaaafffaaeeeeeeeeeeeeeeeeeeeeeee00ff5ffffeeeeeeeeeeeeeeeeeeeee9999ffffff99eeeeeeeeeeeeee
e00000f5ff5f0eeeeeeeeeee78eeeeeeeeeeeeeaafffafffaeeee66666666eeeeeeeeeeee0fff55feeeeeeeeeeeeeeeeeeeeee9999ffffff99eeeeeeeeeeeeee
eee000ffffffeeeeeeeeee7e77eeeeeeeeeeeeeaaffcafcfeaeee67666676eeeeeeeeeeeeeeffffeeeeeeeeeeeeeeeeeeeeee9999fffffff99eeeeeeeeeeeeee
eee00fffffffeeeeeeeeee7e7777eeeeeeeeeeeaafffffffeeeee67766776eeeeeeeeeeee4449944ee1c11c1eeeeeeeeeeeee9999fffffff99eeeeeeeeeeeeee
ee0eefff55feeeeeeeeeee777877eeeeeeeeeeaafff5ffffeeeef67777776eeeeeeeeeee994449944e1c11c1eeeeeeeeeeeee9999ffffff999eeeeeeeeeeeeee
eeee000fffeeeeeeeeeeee7787877eeeeeeeeeeaefff55feeeeef66666666eeeeeeeeee999944994441c11c1eeeeeeeeeeeee99999ffff9999eeeeeeeeeeeeee
eee61110666eeeeeeeeee07787877eeeeeeeeeeeeeffffeeeeeeffffeeeeeeeeeeeeee44999444994565565eeeeeeeeeeeeee99999ff999999eeeeeeeeeeeeee
ee0a66116116eeeeeeee01077877eeeeeeeeeeeeeeeffeeeeeeeffffeeeeeeeeeeeeee44422220022565565eeeeeeeeeeeeee99999ff09999eeeeeeeeeeeeeee
e0a1016a11110eeeeee01107777eeeeeeeeeee1111ffff111eeeeffeeeeeeeeeeeeeee99922202222565565eeeeeeeeeeeeeee99990ff0999eeeeeeeeeeeeeee
01111011a11110ee0061111077eeeeeeeeeee1ddd1ffff1dd1eeeffeeeeeeeeeeeeee99992202928988980eeeeeeeeeeeeeeeee99910019990eeeeeeeeeeeeee
011111001a1111001116111100eeeeeeeeee1dddd11fff11dd11effeeeeeeeeeeeeee444222022289889820eeeeeeeeeeeeeee0991111109110eeeeeeeeeeeee
e0111111001100111116111116eeeeeeeee1dddd1dd111dd1ddd1ffeeeeeeeeeeeeee042222029289889820eeeeeeeeeeeeee011111106111110eeeeeeeeeeee
ea01111111001111111161166eeeeeeeeee1ddd1dddd1dddd1dd1ffeeeeeeeeeeeee0220222022223b33b320eeeeeeeeeeee01111110116110110eeeeeeeeeee
ea001111111111111100e66eeeeeeeeeeeef111ddddd1ddddd11fffeeeeeeeeeeeee0222002029223b33b320eeeeeeeeeee011166601111666010eeeeeeeeeee
eea100111111111100eeeeeeeeeeeeeeeeefff1dddddd1d99d1fffeeeeeeeeeeeeee0222220000223b33b3220eeeeeeeeee0111110611161160110eeeeeeeeee
ee0aaa0011111100eeeeeeeeeeeeeeeeeeefff1dddddd1d99d1eeeeeeeeeeeeeeeeee0022222220ffffff0220eeeeeeeeee0111110161611161010eeeeeeeeee
ee01111100110060eeeeeeeeeeeeeeeeeeefff1d1dddd1dddd1eeeeeeeeeeeeeeeeeeee00022220ffffff0220eeeeeeeeee0110110116111161010eeeeeeeeee
ee01111161001610eeeeeeeeeeeeeeeeeeefff1dd11d1ddd11eeeeeeeeeeeeeeeeeeeeee0200002222fffe00eeeeeeeeeee0110110111111161010eeeeeeeeee
ee01111161111610eeeeeeeeeeeeeeeeeeeefff1dddd1dddd1eeeeeeeeeeeeeeeeeeeeee02202222220eeeeeeeeeeeeeeee0110101111111161010eeeeeeeeee
__gff__
0000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000002222222222222222222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002222222020202020202020220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000222222222222222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
