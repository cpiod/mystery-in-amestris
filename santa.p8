pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
-- noname secret santa
-- cpiod

function _init()
-- o:
-- 0=up, 1=down, 2=left, 3=right
 p={x=9*8;y=4*8;o=1}
 p.ox=p.x
 p.oy=p.y
 
-- mode:
-- 1: move
-- 2: dialog
 mode=1
 
 
 -- npc number:
 -- 1=mustang
 -- 2=postman
 -- 3=apprentice
 npc={{id=1,x=10,y=3}}
end

function _draw()
 cls(0)
	palt(0,false)
	palt(14,true)
	--sspr(0,96,32,32,0,20,64,64)
	--sspr(32,96,32,32,64,20,64,64,true)
	
	map()
	for n in all(npc) do
	 spr(n.id,n.x*8,n.y*8-3)
	end
	spr(16,p.x,p.y-3)
	
	if(mode==2)	prt_dial(d,a)
end

function _update60()
 if(mode==1) update_move()
 if(mode==2) update_diag()
end

function update_diag()
 if(btnp(‚¨ÜÔ∏è) and slct>1) slct-=1
 if(btnp(‚¨áÔ∏è) and slct<#a) slct+=1
 if btnp(üÖæÔ∏è) then
  nb=path[nb][slct]
  if(nb==0 or nb==nil) mode=1 else change_dial()
 end
end

function change_dial()
 slct=1
 d,a=dall[nb],aall[nb]
 if(a==nil) a={"bye"}
end

function start_dial(id)
 mode=2
 chat=id
 nb=1
 change_dial()
end

function update_move()
 if p.x==p.ox and p.y==p.oy then
  -- moving
	 local x,y=p.x,p.y
	 if(btn(‚¨ÜÔ∏è)) p.o=0 y-=8
	 if(btn(‚¨áÔ∏è)) p.o=1 y+=8
	 if(btn(‚û°Ô∏è)) p.o=3 x+=8
	 if(btn(‚¨ÖÔ∏è)) p.o=2 x-=8
	 if(x!=p.x)y=p.y
	 if(fget(mget(x/8,y/8),0)) x,y=p.x,p.y
	 for n in all(npc) do
	 -- npc in path: stop moving, start chatting
	  if(n.x==x/8 and n.y==y/8) x,y=p.x,p.y start_dial(n.id)
	 end
	 p.ox,p.oy=x,y
 else
  if(p.x<p.ox) p.x+=1
  if(p.x>p.ox) p.x-=1
  if(p.y<p.oy) p.y+=1
  if(p.y>p.oy) p.y-=1
 end
end
-->8
--dialog
dall={"first !\nblabla","you said yes","you said no"}
aall={{"yes","no","bye"},{"again","bye"}}
path={{2,3},{1},{}}
slct=1

-- when a={}: add bye

-- chat: character id
-- nb: text id
-- d=text, list of lines
-- a=answers, list of lines
-- s=current selected answers
function prt_dial()
 local i=0
 for n=1,#d do
  if(sub(d,n,n)=="\n") i+=1
 end
 for t in all(a) do
  for n=1,#t do
   if(sub(t,n,n)=="\n") i+=1
  end
 end
 local maxy = 11+6*(i+#a)
 rectfill(3,3,125,maxy,6)
 rect(3,3,125,maxy,7)
 cursor(5,5,0)
 print(d)
 for i=1,#a do
  if i==slct then
   color(12)
   print(">"..a[i])
  else
    color(3)
    print(" "..a[i])
  end
 end
 
end
__gfx__
00000000ee000eeeee1111eeee000eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee0f0eeeeeafaeeeee0f0eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eefffeeeeefffeeeeefffeee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eea61eeeee1ddeeeee4949ee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e71617eeefd1dfeeef222fee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee666eeeeedd1eeeee222eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee1e1eeeeededeeeee2e2eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000ee0e0eeeee0e0eeeee0e0eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee999eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee9f9eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee9f9eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee111eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ef111fee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee111eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee1e1eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ee0e0eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555666666664444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555666776664422224400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555667777664242242400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555666776664224422400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555677666664224422400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555777767764242242400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555677677774422224400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
55555555666667764444444400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeeeeeeeeeeeeeeeeeeeeeee8eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeeeeeeeeeeeeeeeeeeeeeeeee8eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeeee00000eeeeeeeeeeeeeeee89e8eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eeee0000000eeeeeeeeeeeeee88998eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee
eee000000000eeeeeeeeeeee89998eeeeeeeeeee1111111eeeeeeeeeeeeeeeeeeeeeeeeeeee00000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeee99eeeeeeeeeeeeeee
ee0000000f000eeeeeeeeeee89998eeeeeeeeeee1111111eeeeeeeeeeeeeeeeeeeeeeeeeee000ff00eeeeeeeeeeeeeeeeeeeeeee9999999ee9eeeeeeeeeeeeee
ee00000ffff000eeeeeeeeeee998eeeeeeeeeee111111111eeeeeeeeeeeeeeeeeeeeeeeeee00fffff0eeeeeeeeeeeeeeeeeeeee9999fff99eeeeeeeeeeeeeeee
e00000f5ff5f0eeeeeeeeeee78eeeeeeeeeeeee1111111111111eeeeeeeeeeeeeeeeeeeee00ff5ff5feeeeeeeeeeeeeeeeeeee9999ffff99eeeeeeeeeeeeeeee
eee000ffffffeeeeeeeeee7e77eeeeeeeeeeeeeaaaaaaaaaeeeeeeeeeeeeeeeeeeeeeeeee00fffffffeeeeeeeeeeeeeeeeeee99999fffff99eeeeeeeeeeeeeee
eee00fffffffeeeeeeeeee7e7777eeeeeeeeeeeaaaaafffaaeeeeeeeeeeeeeeeeeeeeeeee00ff5ffffeeeeeeeeeeeeeeeeeee9999ffffff99eeeeeeeeeeeeeee
ee0eefff55feeeeeeeeeee777877eeeeeeeeeeeaafffafffaeeee66666666eeeeeeeeeeeee0fff55feeeeeeeeeeeeeeeeeeee9999ffffff99eeeeeeeeeeeeeee
eeee000fffeeeeeeeeeeee7787877eeeeeeeeeeaaffcafcfeaeee67666676eeeeeeeeeeeeeeeffffeeeeeeeeeeeeeeeeeeee9999fffffff99eeeeeeeeeeeeeee
eee61110666eeeeeeeeee07787877eeeeeeeeeeaafffffffeeeee67766776eeeeeeeeeeeee4449944ee1c11c1eeeeeeeeeee9999fffffff99eeeeeeeeeeeeeee
ee0a6611611600eeeeee01077877eeeeeeeeeeaafff5ffffeeeef67777776eeeeeeeeeeee994449944e1c11c1eeeeeeeeeee9999ffffff999eeeeeeeeeeeeeee
e0a1016a11110100eee01107777eeeeeeeeeeeeaefff55feeeeef66666666eeeeeeeeeee999944994441c11c1eeeeeeeeeee99999ffff9999eeeeeeeeeeeeeee
01111011a11110110061111077eeeeeeeeeeeeeeeeffffeeeeeeffffeeeeeeeeeeeeeee44999444994565565eeeeeeeeeeee99999ff999999eeeeeeeeeeeeeee
011111001a1111001116111100eeeeeeeeeeeeeeeeeffeeeeeeeffffeeeeeeeeeeeeeee44422220022565565eeeeeeeeeeee99999ff09999eeeeeeeeeeeeeeee
e0111111001100111116111116eeeeeeeeeeee1111ffff111eeeeffeeeeeeeeeeeeeeee99922202222565565eeeeeeeeeeeee99990ff0999eeeeeeeeeeeeeeee
ea01111111001111111161166eeeeeeeeeeee1ddd1ffff1dd1eeeffeeeeeeeeeeeeeee99992202928988980eeeeeeeeeeeeeee99910019990eeeeeeeeeeeeeee
eae01111111111111100e66eeeeeeeeeeeee1dddd11fff11dd11effeeeeeeeeeeeeeee444222022289889820eeeeeeeeeeeee0991111109110eeeeeeeeeeeeee
eea000111111111100110eeeeeeeeeeeeee1dddd1dd111dd1ddd1ffeeeeeeeeeeeeeee042222029289889820eeeeeeeeeeee011111106111110eeeeeeeeeeeee
eeeaaa001111110010110eeeeeeeeeeeeee1ddd1dddd1dddd1dd1ffeeeeeeeeeeeeee0220222022223b33b320eeeeeeeeee01111110116110110eeeeeeeeeeee
eee011110011006110110eeeeeeeeeeeeeef111ddddd1ddddd11fffeeeeeeeeeeeeee0222002029223b33b320eeeeeeeee011166601111666010eeeeeeeeeeee
eee011116100161101110eeeeeeeeeeeeeefff1dddddd1d99d1fffeeeeeeeeeeeeeee0222220000223b33b3220eeeeeeee0111110611161160110eeeeeeeeeee
eee011116111161101110eeeeeeeeeeeeeefff1dddddd1d99d1eeeeeeeeeeeeeeeeeee0022222220ffffff0220eeeeeeee0111110161611161010eeeeeeeeeee
eee0111161111610e0610eeeeeeeeeeeeeefff1d1dddd1dddd1eeeeeeeeeeeeeeeeeeeee00022220ffffff0220eeeeeeee0110110116111161010eeeeeeeeeee
ee06666666666660e0166eeeeeeeeeeeeeefff1dd11d1ddd11eeeeeeeeeeeeeeeeeeeeeee0200002222fffe00eeeeeeeee0110110111111161010eeeeeeeeeee
ee06666660666660e711eeeeeeeeeeeeeeeefff1dddd1dddd1eeeeeeeeeeeeeeeeeeeeeee02202222220eeeeeeeeeeeeee0110101111111161010eeeeeeeeeee
eee01111661111107771eeeeeeeeeeeeeeeeffff1ddd1dddd1eeeeeeeeeeeeeeeeeeeeeee02202922220eeeeeeeeeeeeee0110101111111160110eeeeeeeeeee
eee01111661111110777eeeeeeeeeeeeeeeeefff1ddd1dddd1eeeeeeeeeeeeeeeeeeeeeee02202222220eeeeeeeeeeeeee0110101000110060110eeeeeeeeeee
eee01111611111111077eeeeeeeeeeeeeeeeee1f1ddd1ddddd1eeeeeeeeeeeeeeeeeeeeee09909999990eeeeeeeeeeeeee0110101111111110110eeeeeeeeeee
eee01111611111111077eeeeeeeeeeeeeeeeeee1dddd1ddddd1eeeeeeeeeeeeeeeeeeeeee09909999990eeeeeeeeeeeeee0110101111111110110eeeeeeeeeee
__gff__
0000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000002222222222222222222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020222222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202022000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002220202020202020202020202200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000002222222020202020202020220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000222222222222222222220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
